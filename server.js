const express=require('express');const fetch=require('node-fetch');const path=require('path');const app=express();app.use(express.json());app.use(express.static(path.join(__dirname,'public')));app.get('/api/weather',async(req,res)=>{const{lat,lon}=req.query;if(!lat||!lon)return res.status(400).json({error:'Missing lat/lon'});try{const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=precipitation_probability,cloudcover,visibility,windgusts_10m`;const r=await fetch(url);const data=await r.json();res.json(data);}catch(e){res.status(500).json({error:e.message});}});app.get('/api/geomagnetic',async(_,res)=>{try{const r=await fetch('https://services.swpc.noaa.gov/json/planetary_k_index_1m.json');const data=await r.json();const latest=data[data.length-1];res.json({kp:latest.kp_index});}catch(e){res.status(500).json({error:e.message});}});app.get('/api/satellite',(_,res)=>{const coverage=Math.round(70+Math.random()*30);res.json({coverage});});app.post('/api/score',(req,res)=>{const{wind,visibility,precipitation,kp,cloud}=req.body;const norm=(v,max)=>Math.max(0,Math.min(1,1-v/max));const weights={wind:0.25,visibility:0.2,precipitation:0.2,kp:0.2,cloud:0.15};const score=(norm(wind,20)*weights.wind+norm(visibility,10)*weights.visibility+norm(precipitation,100)*weights.precipitation+norm(kp,9)*weights.kp+norm(cloud,100)*weights.cloud)*100;res.json({score:Math.round(score)});});const PORT=process.env.PORT||3000;app.listen(PORT,()=>console.log(`UAV Flight Check running on port ${PORT}`));